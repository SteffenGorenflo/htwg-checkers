<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTWG-Checkers</title>

    <link href="css/style.css" rel="stylesheet"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

</head>
<body>

<div id="title" class="center">HTWG Checkers</div>

<div class="center field-container">
    <div id="row0" class="row">
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
    </div>
    <div id="row1" class="row">
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
    </div>
    <div id="row2" class="row">
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
    </div>
    <div id="row3" class="row">
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
    </div>
    <div id="row4" class="row">
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
    </div>
    <div id="row5" class="row">
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
    </div>
    <div id="row6" class="row">
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
    </div>
    <div id="row7" class="row">
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
        <div class="field even"></div>
        <div class="field uneven"></div>
    </div>
</div>

<script>
    var wsUri = "ws://localhost:9000/socket";
    var output;

    // playfield infos
    var field = [
        {
            "pos": {
                "x": 0,
                "y": 1
            },
            "piece": {
                "colour": "Black",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 0,
                "y": 5
            },
            "piece": {
                "colour": "White",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 0,
                "y": 7
            },
            "piece": {
                "colour": "White",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 1,
                "y": 0
            },
            "piece": {
                "colour": "Black",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 1,
                "y": 2
            },
            "piece": {
                "colour": "Black",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 1,
                "y": 6
            },
            "piece": {
                "colour": "White",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 2,
                "y": 1
            },
            "piece": {
                "colour": "Black",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 2,
                "y": 5
            },
            "piece": {
                "colour": "White",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 2,
                "y": 7
            },
            "piece": {
                "colour": "White",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 3,
                "y": 0
            },
            "piece": {
                "colour": "Black",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 3,
                "y": 2
            },
            "piece": {
                "colour": "Black",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 3,
                "y": 6
            },
            "piece": {
                "colour": "White",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 4,
                "y": 1
            },
            "piece": {
                "colour": "Black",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 4,
                "y": 5
            },
            "piece": {
                "colour": "White",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 4,
                "y": 7
            },
            "piece": {
                "colour": "White",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 5,
                "y": 0
            },
            "piece": {
                "colour": "Black",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 5,
                "y": 2
            },
            "piece": {
                "colour": "Black",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 5,
                "y": 6
            },
            "piece": {
                "colour": "White",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 6,
                "y": 1
            },
            "piece": {
                "colour": "Black",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 6,
                "y": 5
            },
            "piece": {
                "colour": "White",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 6,
                "y": 7
            },
            "piece": {
                "colour": "White",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 7,
                "y": 0
            },
            "piece": {
                "colour": "Black",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 7,
                "y": 2
            },
            "piece": {
                "colour": "Black",
                "checkers": false
            }
        },
        {
            "pos": {
                "x": 7,
                "y": 6
            },
            "piece": {
                "colour": "White",
                "checkers": false
            }
        }
    ];
    var currentplayer;
    var possibleTargets;
    var possibleMoves;
    var possibleOrigins;

    var websocket;

    // websocket messages
    // queries
    //    websocket.send(JSON.stringify({query: "getcurrentplayer"}));
    //    websocket.send(JSON.stringify({query: "gamestatus"}));
    //    websocket.send(JSON.stringify({query: "getpossiblepieces"}));
    //    websocket.send(JSON.stringify({query: "getmoves"}));
    //    websocket.send(JSON.stringify({query: "getpossibletargets", x: 1, y: 1}));
    //
    //    // execute
    //    websocket.send(JSON.stringify({execute: "quitgame"}));
    //    websocket.send(JSON.stringify({execute: "newgame"}));
    //    websocket.send(JSON.stringify({execute: "setpiece", x1: 1, y1: 1, x2: 2, y2: 2}));

    var socketFunction = {
        onOpen: mainFunction,
        onError: function (event) {
            console.error('Websocket Error', event);
        },
        onClose: function (event) {
            console.log('Websockets closed', event)
        },
        onMessage: function (event) {
            var data = JSON.parse(event.data);

            if (data.moves) {
                possibleMoves = data.moves;
            } else if (data.vector) {
                field = data.vector;
                update();
            } else if (data.origins) {
                possibleOrigins = data.origins;
            } else if (data.targets) {
                possibleTargets = data.targets;
            } else if (data === 'Black' || data === 'White') {
                currentplayer = data;
            } else {
                console.log("Got unkown message", data);
            }
        }
    };

    $(document).ready(function () {
        websocket = new WebSocket(wsUri);
        websocket.onopen = socketFunction.onOpen;
        websocket.onclose = socketFunction.onClose;
        websocket.onmessage = socketFunction.onMessage;
        websocket.onerror = socketFunction.onError;

    });

    var mainFunction = function () {

        // init playfield
        update();

        $('.field').on('click', function (e) {
            console.log(e);
            console.log($(this))
        });

        websocket.send(JSON.stringify({query: "gamestatus"}));
    };


    function update() {
        console.log('Update playfield');
        var i, pos, id, col, color;
        for (i = 0; i < field.length; ++i) {
            pos = field[i].pos;
            id = '#row' + pos.y;
            col = ' div:nth-child(' + (pos.x + 1) + ')';

            color = field[i].piece.colour === 'Black' ? '<img src="images/BLACK.png">' : '<img src="images/WHITE.png">';
            $(id + ' ' + col).append(color);

            console.log(field[i])
            console.log(i)
        }

    }


</script>
</body>
</html>